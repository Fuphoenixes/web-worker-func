function __spreadArray(e,r,n){if(n||2===arguments.length)for(var t,a=0,o=r.length;a<o;a++)!t&&a in r||((t=t||Array.prototype.slice.call(r,0,a))[a]=r[a]);return e.concat(t||Array.prototype.slice.call(r))}var defaultOptions={timeout:0,importScripts:[],transferable:!0},jobRunner=function(e){var o=e.fn,i=e.transferable;return function(e){var r,n=e.data;try{var t=o.apply(void 0,n),a=i&&(r=t,"ArrayBuffer"in self&&r instanceof ArrayBuffer||"MessagePort"in self&&r instanceof MessagePort||"ImageBitmap"in self&&r instanceof ImageBitmap||"OffscreenCanvas"in self&&r instanceof self.OffscreenCanvas)?[t]:[];postMessage(["SUCCESS",t],a)}catch(e){postMessage(["ERROR",e])}}},importScriptsParser=function(e){return 0===e.length?"":(e=e.map(function(e){return"'".concat(e,"'")}).toString(),"importScripts(".concat(e,");"))},createWorkerBlobUrl=function(e,r,n){r="\n    ".concat(importScriptsParser(r),"\n    onmessage=(").concat(jobRunner,")({ fn: (").concat(e,"), transferable: ").concat(n," })\n  "),e=new Blob([r],{type:"text/javascript"});return URL.createObjectURL(e)},webWorkerBuilder=function(c,e){var f=Object.assign(defaultOptions,e);return function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return new Promise(function(n,t){function a(){o.terminate(),URL.revokeObjectURL(r),f.timeout&&window.clearTimeout(e)}var e,r=createWorkerBlobUrl(c,f.importScripts,f.transferable),o=new Worker(r),i=f.transferable?s.filter(function(e){return"ArrayBuffer"in window&&e instanceof ArrayBuffer||"MessagePort"in window&&e instanceof MessagePort||"ImageBitmap"in window&&e instanceof ImageBitmap||"OffscreenCanvas"in window&&e instanceof window.OffscreenCanvas}):[];o.postMessage(__spreadArray([],s,!0),i),o.onmessage=function(e){var e=e.data,r=e[0],e=e[1];("SUCCESS"===r?n:t)(e),a()},o.onerror=function(e){t(e),a()},f.timeout&&(e=window.setTimeout(function(){t("worker timeout"),a()},f.timeout))})}};export{webWorkerBuilder as default};
